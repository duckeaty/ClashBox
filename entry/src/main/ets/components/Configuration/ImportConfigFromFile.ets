import { BreakpointState } from "../../common/breakpointsystem"
import {
  BIND_SHEET_MAIN_FONT_WEIGHT,
  BIND_SHEET_MAIN_FONTSIZE,
  BIND_SHEET_SUB_FONTSIZE,
  BIND_SHEET_TITLE_CONTAINER_HEIGHT,
  BIND_SHEET_DRAG_BAR_HEIGHT,
  BIND_SHEET_TITLE_LEFT_SYMBOL_WEIGHT
} from "../../common/Constants"
import { BindSheetTitleCustomBuilder } from "../Common"
import { hilog } from "@kit.PerformanceAnalysisKit"
import { picker } from "@kit.CoreFileKit"
import ClashViewModel from "../../entryability/ClashViewModel"
import { getResourceString } from "../../utils/ResourceStringUtil"


// 关联：route_map.json
@Builder
export function ImportConfigFromFileBuilder(name: string, param: Object){
  ImportConfigFromFile()
}


@Component
export struct ImportConfigFromFile{

  private componentName: string = 'ImportConfigFromFile'

  /* NV 路由相关 */
  @Consume('configAddPageInfos')
  // 页面栈
  private configAddPageInfos: NavPathStack

  /* 断点相关 */
  // NV容器的padding
  @Consume('breakPointStateNavigationListPadding')
  breakPointStateNavigationListPadding: BreakpointState<number>

  // NV title Builder
  @State
  private mainTitle: string = getResourceString($r('app.string.add_config'), this)
  @State
  private subTitle: string = getResourceString($r('app.string.import_from_file'), this)


  build() {
    NavDestination() {
      // 替代`NavDestination`的标题栏 START
      BindSheetTitleCustomBuilder({
        pageInfos: this.configAddPageInfos,
        isSubPage: true,
        titlePaddingLeft: BIND_SHEET_DRAG_BAR_HEIGHT / 2,
        mainTitle: this.mainTitle,
        subTitle: this.subTitle,
        mainTitleFontWeight: BIND_SHEET_MAIN_FONT_WEIGHT,
        mainTitleFontSize: BIND_SHEET_MAIN_FONTSIZE,
        subTitleFontSize: BIND_SHEET_SUB_FONTSIZE,
        titleBackgroundColor: $r('app.color.background'),
        padding: {
          // 为什么设置`15`，看Builder的参数中`padding`的介绍：ConfigAddBindSheetTitleBuilderParam
          left: 15,
          // left: this.breakPointStateNavigationListPadding.value,
          right: BIND_SHEET_TITLE_LEFT_SYMBOL_WEIGHT + 15 * 2
          // right: this.breakPointStateNavigationListPadding.value
        },
        menus: []
      })
      // 替代`NavDestination`的标题栏 END

      // START
      Column() {
        Text(this.componentName).fontSize(50)
        Text(`breakPointStateNavigationListPadding.value is [${this.breakPointStateNavigationListPadding.value?.toString()}]`)

      }.width('100%').height('auto').backgroundColor('#ff007e59').alignItems(HorizontalAlign.Start)
      // END
    }
    .height('100%')
    .hideTitleBar(true)
    // .title({builder: , height: BIND_SHEET_TITLE_CONTAINER_HEIGHT + BIND_SHEET_DRAG_BAR_HEIGHT})
    .backgroundColor($r('app.color.container_background'))
    // .onBackPressed(() => {
    //   this.configAddPageInfos.pop(true)
    //   return true
    // })

  }

  aboutToAppear(): void {
    let filePicker = new picker.DocumentViewPicker(getContext(this))
    let options = new picker.DocumentSelectOptions()
    filePicker.select(options).then((documentSelectResult)=>{
      const url = documentSelectResult[0];
      ClashViewModel.addOrUpdateProfileByFile(url, null)
    })
    hilog.info(0xCC10, this.componentName, `#aboutToAppear executed`)
  }

  aboutToDisappear(): void {
    hilog.info(0xCC10, this.componentName, `#aboutToDisappear executed`)
  }
}